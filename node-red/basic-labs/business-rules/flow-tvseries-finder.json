[{"id":"8a1604b4.02c3b8","type":"function","z":"24eaa0b5.1a8cc8","name":"Build Decision Payload ","func":"function IsJsonString(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\nif (context.global.nbtweets_analysed===undefined)\n\tcontext.global.nbtweets_analysed=0;\nelse\n\tcontext.global.nbtweets_analysed++;\n\nvar escaped_tweet = msg.payload.replace(/[^\\w\\s#@:.%/-]/gi, '');\n\nvar tweet = {};\ntweet.sentiment = msg.sentiment;\ntweet.payload = escaped_tweet;\ntweet.topic = msg.tweet.user.screen_name;\ntweet.lang = msg.lang;\ntweet.retweeted = msg.tweet.retweeted;\ntweet.source = encodeURI(msg.tweet.source);\ntweet.followers_count = msg.tweet.user.followers_count;\ntweet.friends_count = msg.tweet.user.friends_count;\ntweet.favorites_count = msg.tweet.favorite_count;\ntweet.geo_enabled = msg.tweet.user.geo_enabled;\ntweet.geo = msg.tweet.geo!==null? 'n a':null;\n\nvar business_rules_data = {};\nbusiness_rules_data.tweet = tweet;\n\nvar msg2={};\nmsg2.payload = JSON.stringify(business_rules_data);\n\nmsg3={};\nmsg3.payload={\"nbtweets_analysed\":context.global.nbtweets_analysed};\nif (IsJsonString(msg2.payload)===true)\n return [msg3,msg2];\nelse\n console.log('message ignored')","outputs":"2","noerr":0,"x":778,"y":193.99998474121094,"wires":[["cfb08d04.758578"],["ad419c6b.a89bd"]]}]